!function(e){var t={};function s(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=104)}({104:function(e,t){function s(){return $("input, #confirm-button")}function a(){s().attr("disabled","disabled").addClass("disabled")}function n(){s().removeAttr("disabled").removeClass("disabled"),$(".always-disabled").attr("disabled","disabled").addClass("disabled")}function o(){let e={},t=0;e.username=$("#input-username").val().trim(),e.username.length>0&&t++,e.domain=parseInt($("#input-domain").val().trim()),isNaN(e.domain)||t++,e.quota=$("#input-quota").val().trim(),e.quota.length>0&&t++,e.password=$("#input-password").val().trim(),!edit&&0==e.password.length||$("#input-confirmpass").val().trim()!=e.password?(e.password.length>0&&($.notify({message:"The passwords are not identical."},{type:"warning"}),t--),e.password=""):t++;let s=-1;return edit&&t>=3||!edit&&4==t?s=1:t>0&&(s=0),{completion:s,data:e}}function r(){let e={},t=o();return t.completion>0?(t=t.data,t.quota!=values.quota&&(e.quota=t.quota),t.password.length>0&&(e.password=window.unixcrypt.encrypt(t.password)),e):null}let i=void 0;window.mails_manageuser={init:function(){let e=$("#input-domain");for(let t of window.domains)e.append(`<option value="${t.id}">${t.name}</option>`);edit&&($("#input-username").val(values.email.split("@")[0]),$("#input-domain").val(values.domain_id)),window.onbeforeunload=()=>{if(!saving&&(!edit&&o().completion>=0||Object.keys(r()).length>0))return"You have unsaved changes on this page. Do you want to leave?"}},confirm:function(){let e=$("#confirm-button");if(edit){let e=r();if(null!=e){let t=Object.keys(e).length;if(0==t)$.notify({message:"No changes made."},{type:"warning"});else{i=e;let s="You modified the following propert"+(1==t?"y":"ies")+":<ul>";null!=e.quota&&(s+=`<li>Quota: ${e.quota} <small>(from ${values.quota})</small></li>`),null!=e.password&&(s+="<li>Account password (hidden)</li>"),s+="</ul>",$("#confirmModal-content").html(s),$("#confirmModal").modal()}}}else{let t=o();1==t.completion&&(saving=!0,a(),utils.disableButton(e,"Creating the address..."),t.data.encrypted=!0,$.post("/api/v1/mails/users/create",t.data).fail((t,s,a)=>{saving=!1,$.notify({message:"Unable to create this address. See console for details."},{type:"danger"}),console.warn("Unable to create address (server error):",a),n(),utils.enableButton(e,"Create this address")}).done(t=>{t.error?(saving=!1,$.notify({message:"Unable to create this address. See console for details."},{type:"danger"}),console.warn("Unable to create address (application error):",error),n(),utils.enableButton(e,"Create this address")):(utils.addNotification("Address successfully added.","success"),location.href="/panel/mails/users")}))}return!1},confirmSave:function(){if(null==i)return;let e=i;e.encrypted=!0,i=void 0;let t=$("#confirm-button");saving=!0,a(),utils.disableButton(t,"Saving changes..."),$("#confirmModal").modal("hide"),$.post("/api/v1/mails/users/edit/"+values.id,e).fail((e,s,a)=>{saving=!1,$.notify({message:"Unable to edit this address. See console for details."},{type:"danger"}),console.warn("Unable to edit address (server error):",a),n(),utils.enableButton(t,"Edit this address")}).done(e=>{e.error?(saving=!1,$.notify({message:"Unable to edit this address. See console for details."},{type:"danger"}),console.warn("Unable to edit address (application error):",error),n(),utils.enableButton(t,"Edit this address")):(utils.addNotification("Address successfully edited.","success"),location.href="/panel/mails/users")})},resetSSOPassword:function(){let e=$("#reset-ssopassword").attr("disabled","disabled");$.getJSON("/api/v1/mails/users/resetssopassword/"+values.id).fail((e,t,s)=>{$.notify({message:"Unable to reset the SSO password. See console for details."},{type:"danger"}),console.warn("Unable to reset the SSO password (server error):",s)}).done(e=>{e.error?($.notify({message:"Unable to reset the SSO password. See console for details."},{type:"danger"}),console.warn("Unable to reset the SSO password (application error):",error)):$.notify({message:"Webmail SSO password reset."},{type:"success"})}).always(()=>{e.removeAttr("disabled")})}}}});