!function(e){var t={};function n(o){if(t[o])return t[o].exports;var l=t[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(o,l,function(t){return e[t]}.bind(null,l));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="pKi5")}({pKi5:function(e,t){let n,o={},l={};function a(e,t){return btoa(e+"$ _ _ $"+t)}function s(){return Math.floor(1e6*Math.random())}function r(e){return e.replace(window.root_domain,"<b>"+window.root_domain+"</b>")}function c(){0==Object.keys(o).length?($("#challenges-status").show().html("No DNS challenge found."),$("#challenges-card").hide()):($("#challenges-status").hide(),$("#challenges-card").show())}let d=void 0;let i=void 0,u=-1;window.dns_challenges={init:function(){n=io("/v1/system",{transports:["websocket"]}),n.on("connect",(function(){console.log("Socket connected."),n.emit("authentication",{key:API_KEY}),n.on("authenticated",(function(){console.log("Socket authenticated."),n.emit("setup",{type:"dns_challenges"})})),n.on("unauthorized",(function(e){$.notify({message:"Unable to authenticate to the socket."},{type:"danger"}),$("#challenges-status").html("Unable to load DNS challenges."),console.log("Unauthorized from the socket",e)}))})),n.on("error",e=>{$.notify({message:"Connection with the socket lost."},{type:"danger"}),$("#challenges-status").html("Connection with the DNS challenges server lost (socket error)."),console.log("Socket error",e)}),n.on("dns_challenges_add",e=>{let t=s(),{host:n,token:d}=e;var i;o[t]={host:n,token:d},l[a(n,d)]=t,i={cid:t,host:n,token:d},$("#challenges-list").append(`<li class="list-group-item" id="challenge-${i.cid}">\n        ${r(i.host)}<samp class="ml-md-4 text-secondary">${i.token}</samp>\n        <span class="float-md-right"><div class="btn-group" role="group" style="margin: -3px -10px;"><button onclick="dns_challenges.testChallenge(${i.cid})" class="btn btn-sm btn-info thinable-btn"><i class="fas fa-clipboard-check"></i> <span>Check</span></button>\n        <button id="challenge-${i.cid}-rembtn" onclick="dns_challenges.askRemove(${i.cid})" class="btn btn-sm btn-danger thinable-btn"><i class="fas fa-trash-alt"></i> <span>Remove</span></button></div></span></li>`),c(),thin_buttons.prepareButtons()}),n.on("dns_challenges_remove",e=>{let{host:t,token:n}=e,s=function(e,t){return l[a(e,t)]}(t,n);null!=s&&(delete o[s],delete l[a(t,n)],$("#challenge-"+s).remove(),c())}),n.on("dns_challenges_checked",e=>{let t=e.cid,n=o[t];if(e.uniqueResponseId==i&&null!=n)if(u>=0&&(clearTimeout(u),u=-1),i=void 0,null!=e.error){let t=e.error;t instanceof Error||(t=new Error(JSON.stringify(t))),$("#testPopup-status").html("Check encountered an error:"),$("#testPopup-close").html("Close"),$("#testPopup-results").html(t).parent().show()}else{let t=n.token,o=e.results.includes(t);$("#testPopup-status").html("Check done. Results are below:"),$("#testPopup-close").html("Close results"),$("#testPopup-results").html(e.results.map(e=>"<span class='"+(o&&t!=e?"text-black-50":"")+"'>"+e+"</span>").join("\n")).parent().show(),o?$("#testPopup-alert").addClass("alert-success").html("Result: <b>SUCCESS</b><span class='ml-md-3'>(token found in records)</span>").show():$("#testPopup-alert").addClass("alert-danger").html("Result: <b>FAILED</b><span class='ml-md-3'>(token not found in records)</span>").show()}}),n.on("setup",e=>{e.error?($.notify({message:"Cannot setup server connection."},{type:"danger"}),$("#challenges-status").html("Unable to load DNS challenges."),console.log("Socket error",e.error)):c()})},askRemove:function(e){let t=o[e];null!=t&&(d=e,$("#deleteModal-content").html("Do you really want to remove the challenge on host <i>"+r(t.host)+"</i> with value:<br/><samp class='text-secondary'>"+t.token+"</samp><br/><br/><i class='fas fa-exclamation-triangle'></i> Warning: If you didn't create manually this challenge, removing it can cause issues about SSL certificates renewal."),$("#deleteModal").modal())},confirmRemove:function(){$("#deleteModal").modal("hide"),null!=d&&($("#challenge-"+d+"-rembtn").attr("disabled","disabled"),n.emit("dns_challenge_cmd",{command:"remove",...o[d]}),d=void 0)},openAddPopup:function(){$("#addPopup-host").val(""),$("#addPopup-token").val(""),$("#addPopup").modal()},confirmAdd:function(){let e=$("#addPopup-host"),t=e.val().trim().toLowerCase(),o=$("#addPopup-token").val().trim();o.length>0?($("#addPopup").modal("hide"),"root"==e.attr("data-mode")&&(t.length>0?t+="."+window.root_domain:t=window.root_domain),n.emit("dns_challenge_cmd",{command:"set",host:t,token:o})):$.notify({message:"Invalid fields or empty token."},{type:"warning",z_index:9999,placement:{from:"bottom",align:"center"},animate:{enter:"animated fadeInUp",exit:"animated fadeOutDown"}})},testChallenge:function(e){let t=o[e];null!=t&&(u>=0&&(clearTimeout(u),u=-1),i=s(),$("#testPopup-status").html("Checking challenge..."),$("#testPopup-results").html("").parent().hide(),$("#testPopup-close").html("Cancel"),$("#testPopup-alert").removeClass("alert-success alert-danger").html("").hide(),$("#testPopup").modal(),n.emit("dns_challenge_cmd",{command:"check",host:t.host,uniqueResponseId:i,cid:e}),u=setTimeout(()=>{u=-1,i=void 0,$("#testPopup-status").html("Check timed out!<br/>Please try again."),$("#testPopup-close").html("Close")},8e3))},toggleAddMode:function(){let e=$("#addPopup-host");"root"==e.attr("data-mode")?(e.attr("data-mode","free"),$("#addPopup-root").hide()):(e.attr("data-mode","root"),$("#addPopup-root").show())}}}});