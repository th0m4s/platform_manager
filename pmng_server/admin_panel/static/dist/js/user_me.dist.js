!function(e){var a={};function t(n){if(a[n])return a[n].exports;var s=a[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,t),s.l=!0,s.exports}t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var s in e)t.d(n,s,function(a){return e[a]}.bind(null,s));return n},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s="dgcm")}({dgcm:function(e,a){let t=!0;function n(e){null==e?(t=!0,$("#email-change").hide(),$("#input-email").removeAttr("disabled").removeClass("always-disabled")):(t=!1,$("#email-change-email").html(e).parent().show(),$("#input-email").attr("disabled","disabled").addClass("always-disabled"))}function s(){let e={},a=$("#input-newpass").val().trim();if(a.length>0){if(a!=$("#input-confirmpass").val().trim())return null;e.password=a}let n=$("#input-fullname").val().trim();n!=user.fullname&&(e.fullname=n);let s=$("#input-email").val().trim();return s!=user.email&&t&&(e.email=s),e}function r(){return $("input, #confirm-button")}function l(){n(void 0),$.notify({message:"No email change request was found."},{type:"info"})}window.user_me={init:function(){if($("#input-username").val(user.name),$("#input-fullname").val(user.fullname),$("#input-email").val(user.email),n(newEmail),window.onbeforeunload=()=>{let e=s();if(null==e||Object.keys(e).length>0)return"You have unsaved changes on this page. Do you want to leave?"},Object.keys(remoteGits).length>0){$("#gitusers-status").hide();let e=$("#gitusers-list").html("");for(let[a,t]of Object.entries(remoteGits)){let n=t.available;e.append(`<li class="list-group-item" id="line-gituser-${a}"><b>${(0!=t.icon?`<i class="${t.icon}"></i> `:"")+t.name} </b> <span class="text-secondary d-block d-md-inline"><samp class="ml-4" id="status-gituser-${a}">${n?"Account linked":"Account not linked"}</samp></span><span class="float-md-right d-block d-md-inline mt-2 mt-md-0"><div class="btn-group" role="group" style="margin: -3px -10px;"><button class="btn btn-sm btn-${n?"secondary":"primary"}" onclick="user_me.invertGitProvider('${a}', this)"><i class="fas fa-${n?"unlink":"link"}"></i> ${n?"Unlink":"Link"} account</button></div></span></li>`)}e.parent().show()}else $("#gitusers-status").html("No git provider found.").show()},save:function(){let e=s();if(0==Object.keys(e).length)$.notify({message:"No changes made."},{type:"warning"});else{let a=$("#input-password").val().trim();if(a.length<8)$.notify({message:"Invalid current password."},{type:"warning"});else{let t=$("#confirm-button");r().attr("disabled","disabled").addClass("disabled"),utils.disableButton(t,"Saving changes..."),$.post("/api/v1/users/me",{changes:e,currentPassword:a}).fail((e,a,t)=>{$.notify({message:"Unable to contact server. See console for details."},{type:"danger"}),console.warn("Unable to edit account (server error):",t)}).done(a=>{a.error?($.notify({message:"Unable to save the changes. See console for details."},{type:"danger"}),console.warn("Unable to edit account (application error):",error)):(202==a.code?($.notify({message:"Email change request created. Please first allow the change by clicking Allow on your current email address."},{type:"success"}),n(e.email),$("#input-email").val(user.email)):($.notify({message:"Changes saved."},{type:"success"}),206==a.code?($.notify({message:"Email was not updated because a request already exists."},{type:"warning"}),n(a.newEmail),delete e.email):null!=e.email&&($.notify({message:"To allow the email change, please click Allow on your current email address."},{type:"info"}),$("#input-email").val(user.email),n(e.email),delete e.email)),function(e){user=Object.assign(user,e)}(e),$("input[type=password]").val(""))}).always(()=>{r().removeAttr("disabled").removeClass("disabled"),$(".always-disabled").attr("disabled","disabled").addClass("disabled"),utils.enableButton(t,"Save changes")})}}return!1},resetSSOPassword:function(){let e=$("#reset-dbautopass").attr("disabled","disabled");$.getJSON("/api/v1/users/me/resetdbautopass").fail((e,a,t)=>{$.notify({message:"Unable to reset the database SSO password. See console for details."},{type:"danger"}),console.warn("Unable to reset dbautopass (server error):",t)}).done(e=>{e.error?($.notify({message:"Unable to reset the database SSO password. See console for details."},{type:"danger"}),console.warn("Unable to reset dbautopass (application error):",error)):$.notify({message:"Database SSO password reset."},{type:"success"})}).always(()=>{e.removeAttr("disabled")})},cancelEmailChange:function(){return t||($("#email-change-email").removeAttr("href"),$.getJSON("/api/v1/users/me/cancelEmailChange").fail((e,a,t)=>{404==a?l():($.notify({message:"Unable to cancel the email change request. Please click Deny in the mail you received on your current email address."},{type:"danger"}),console.warn("Cannot cancel email change request (server error):",t))}).done(e=>{e.error?404==e.code?l():($.notify({message:"Cannot cancel the email change request. Please click Deny in the mail you received on your current email address."},{type:"danger"}),console.warn("Cannot cancel email change request (application error):",e.message)):($.notify({message:"Email change request successfully canceled."},{type:"success"}),n(void 0))}).always(()=>{$("#email-change-email").attr("href","#")})),!1},invertGitProvider:function(e,a){let t=remoteGits[e];null!=t&&(a=$(a).attr("disabled","disabled"),t.available?$.getJSON("/api/v1/git/"+e+"/unlinkAccount").fail((a,n,s)=>{$.notify({message:"Unable to unlink your "+t.name+" account."},{type:"danger"}),console.error("Cannot unlink "+e+" account (server error)",n,s)}).done(n=>{n.error?($.notify({message:"Unable to unlink your "+t.name+" account."},{type:"danger"}),console.error("Cannot unlink "+e+" account (application error)",error)):(t.available=!1,$(a).addClass("btn-primary").removeClass("btn-secondary").html("<i class='fas fa-link'></i> Link account"),$("#status-gituser-"+e).html("Account not linked"),$.notify({message:t.name+" account unlinked successfully."},{type:"success"}))}).always(()=>{a.removeAttr("disabled")}):location.href="/panel/git/"+e+"/auth")}}}});